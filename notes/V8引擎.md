### 认识V8

1. 主流的JavaScript执行引擎
2. V8采用即时编译
3. V8内存设限（64位系统-1.5G，32位系统-800M）

### V8垃圾回收策略

- 采用分代回收的思想
- 内存分为新生代、老生代
- 根据不同对象采用不同GC算法

### V8常用GC算法

- 分代回收
- 控件复制
- 标记清除
- 标记整理
- 标记增量

### V8如何回收新生代对象

- V8内存空间一分为二

	![V8内存分配](https://note.youdao.com/yws/public/resource/cf4c1c1f89527ccacdbaf2bb51c1a8fd/xmlnote/WEBRESOURCE37acd531e447c7df29cc1ec02ee00aa6/1138)

- 小空间用于存储新生代对象（62位-32M，32位-16M）
- 新生代指的是存活时间较短的对象。 ** 如何界定呢？举例：当前代码内有一个局部作用域，局部作用域里的变量在执行完成后就要去进行回收；而在全局的地方也可能存在一个变量，但是全局里面的变量，需要程序退出后才会进行回收 **

新生代对象回收实现

- 回收过程采用**复制算法+标记整理**
- 新生代内存区分为两个等大小空间
- 使用空间为From，空闲空间为To
- 活动对象存储于From
- 标记整理后将活动对象拷贝至To
- From与To交换空间完成释放

新生代回收细节说明

- 拷贝过程在可能存在出现晋升。例如：如果我们在拷贝时发现某一个变量对象所指向的空间在我们当前的老生代中也会出现
- 晋升就是将新生代对象移动至老生代
- 判断晋升的标准：
	- 一轮Gc还存活的新生代需要晋升
	- To空间的使用率超过25%

### V8如何回收老生代对象

- 老生代对象存放在右侧老生代区域
- 存储内存大小设限（64位系统-1.4G，32位系统-700M）
- 老生代对象就是指存活时间较长的对象。**例如：在全局环境下所存在的变量或者一些闭包里存在的变量数据**

老对象回收实现

- 主要采用**标记清除、标记整理、增量标记算法**
- 首先使用标记清除完成垃圾空间的回收

	虽然标记清除存在空间碎片化的问题，但是对于执行的速度还是明显的

- 采用标记整理进行空间优化

	在何种情况下使用呢？如果新生代区域的内容想要往老生代区域进行移动的时候，而且这个时候老生代区域的空间不足以存放新生代存储区域移动过来的对象，也就是晋升，这时候会触发标记整理算法

- 采用增量标记进行效率优化
	
	**注意：垃圾回收操作的时候会阻塞js程序执行**

### 新生代对象回收和老生代对象回收细节对比

- 新生代区域垃圾回收使用空间换时间

	因为存在To空闲空间，所以是花费了多余的空闲内存，但是相较于新生代对象区域里本来就使用很少的内存空间，空闲空间相对更小，所以这部分的空间浪费相对于它所带来的时间上的提升，是微不足道的。

- 老生代区域垃圾回收不适合复制算法

	由于老生代区域里存储的对象比较多，所以在复制过程中消耗的时间也比较多。

